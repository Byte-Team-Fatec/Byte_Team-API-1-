{% extends "base_light.html" %}
{% block head_extras %}
<link rel="stylesheet" href="{{url_for('static', filename = 'perfil.css')}}">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
{% endblock %}

{% block content %}
    <div class="container">
        <div class="left-section">
            <div class="card">
                <!-- A foto do vereador será exibida aqui no card da esquerda -->
                <img src="{{ url_for('static', filename=vereador['id']) }}" alt="{{ vereador['nome'] }}">
                <h1>{{ vereador['nome_civil'] }}</h1>
                <h2>{{ vereador['partido_sigla'] }}</h2>
                <p><strong>Telefone:</strong> {{ vereador['telefone'] }}</p>
                <p class="email" id="email"><strong>E-mail:</strong> {{ vereador['email'] }}</p>
                <p><strong>Nº do Gabinete:</strong> {{ vereador['gabinete'] or 'Informação não disponível' }}</p>
            </div>
            <button class="comment-btn">ADICIONE UM COMENTÁRIO...</button>
        </div>

        <div class="right-section">
            <div id="filtro">
                <select id="filtro-selecao">
                    <option value="biografia">Dados Biográficos</option>
                    <option value="projetos_aprovados">Projetos Aprovados</option>
                </select>
                <button id="btnFiltrar">Filtrar</button>
            </div>

            <div class="info-box" id="info-box">
                <h2>INFORMAÇÕES</h2>
                <div id="conteudo-card">
                    <p>Selecione um filtro para ver as informações correspondentes.</p>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <h4>developed by byte</h4>
    </footer>

    <script>
        function filtrarDados(filtroSelecionado) {
            console.log("Filtro selecionado:", filtroSelecionado); // Verifica se o filtro está correto
            
            fetch(`/perfil/filtros?vereador_id={{ vereador['id'] }}&filtro=${filtroSelecionado}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erro na requisição: ' + response.status);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log("Dados recebidos:", data); // Verifica os dados recebidos
                    const conteudoCard = document.getElementById("conteudo-card");
                    conteudoCard.innerHTML = ""; // Limpa o conteúdo anterior

                    if (filtroSelecionado === "biografia") {
                        conteudoCard.innerHTML = `<p>${data.biografia}</p>`;
                    } else if (filtroSelecionado === "projetos_aprovados") {
                        const ul = document.createElement("ul");
                        data.projetos_aprovados.forEach(projeto => {
                            const li = document.createElement("li");
                            li.innerHTML = `<strong>${projeto.titulo}</strong> - ${projeto.descricao} <a href="${projeto.link_detalhes}" target="_blank">Ver Detalhes</a>`;
                            ul.appendChild(li);
                        });
                        conteudoCard.appendChild(ul);
                    }
                })
                .catch(error => {
                    console.error("Erro ao filtrar dados:", error); // Mostra erros no console
                    document.getElementById("conteudo-card").innerHTML = "<p>Erro ao carregar informações. Tente novamente mais tarde.</p>";
                });
        }

        // Evento de clique no botão de filtro
        document.getElementById("btnFiltrar").addEventListener("click", function() {
            const filtroSelecionado = document.getElementById("filtro-selecao").value;
            filtrarDados(filtroSelecionado);
        });
    </script>
{% endblock %}
