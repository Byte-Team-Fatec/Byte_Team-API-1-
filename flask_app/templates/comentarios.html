{% extends "base_light.html" %}
{% block head_extras %}
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="{{url_for('static', filename = 'comentarios.css')}}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900&display=swap"
        rel="stylesheet">
{% endblock %}
{% block content %}

<h2>Comentários</h2>

<!-- Fotos dos vereadores em círculos no topo -->
<div id="vereadores-carousel" class="carousel">
    <div class="carousel-track">
        <img src="{{ url_for('static', filename='imagens/img/35.jpg') }}" alt="Vereador 35">
        <img src="{{ url_for('static', filename='imagens/img/38.jpg') }}" alt="Vereador 38">
        <img src="{{ url_for('static', filename='imagens/img/40.jpg') }}" alt="Vereador 40">
        <img src="{{ url_for('static', filename='imagens/img/43.jpg') }}" alt="Vereador 43">
        <img src="{{ url_for('static', filename='imagens/img/44.jpg') }}" alt="Vereador 44">
        <img src="{{ url_for('static', filename='imagens/img/45.jpg') }}" alt="Vereador 45">
        <img src="{{ url_for('static', filename='imagens/img/47.jpg') }}" alt="Vereador 47">
        <img src="{{ url_for('static', filename='imagens/img/50.jpg') }}" alt="Vereador 50">
        <img src="{{ url_for('static', filename='imagens/img/55.jpg') }}" alt="Vereador 55">
        <img src="{{ url_for('static', filename='imagens/img/234.jpg') }}" alt="Vereador 234">
        <img src="{{ url_for('static', filename='imagens/img/237.jpg') }}" alt="Vereador 237">
        <img src="{{ url_for('static', filename='imagens/img/238.jpg') }}" alt="Vereador 238">
        <img src="{{ url_for('static', filename='imagens/img/239.jpg') }}" alt="Vereador 239">
        <img src="{{ url_for('static', filename='imagens/img/240.jpg') }}" alt="Vereador 240">
        <img src="{{ url_for('static', filename='imagens/img/242.jpg') }}" alt="Vereador 242">
        <img src="{{ url_for('static', filename='imagens/img/243.jpg') }}" alt="Vereador 243">
        <img src="{{ url_for('static', filename='imagens/img/244.jpg') }}" alt="Vereador 244">
        <img src="{{ url_for('static', filename='imagens/img/245.jpg') }}" alt="Vereador 245">
        <img src="{{ url_for('static', filename='imagens/img/246.jpg') }}" alt="Vereador 246">
        <img src="{{ url_for('static', filename='imagens/img/247.jpg') }}" alt="Vereador 247">
        <img src="{{ url_for('static', filename='imagens/img/249.jpg') }}" alt="Vereador 249">
    </div>
</div>


<!-- Barra de pesquisa no topo -->
<div id="search-bar">
    <form method="GET" action="/comentarios_filtro">
        <label for="vereador_id">Vereador:</label>
        <select name="vereador_id">
            <option value="">Todos</option>
            {% for vereador in vereadores %}
                <option value="{{ vereador.id }}">{{ vereador.nome }}</option>
            {% endfor %}
        </select>

        <label for="partido_id">Partido:</label>
        <select name="partido_id">
            <option value="">Todos</option>
            {% for partido in partidos %}
                <option value="{{ partido.id }}">{{ partido.nome }}</option>
            {% endfor %}
        </select>

        <label for="comissao_id">Comissão:</label>
        <select name="comissao_id">
            <option value="">Todas</option>
            {% for comissao in comissoes %}
                <option value="{{ comissao.id }}">{{ comissao.nome }}</option>
            {% endfor %}
        </select>

        <button type="submit">Filtrar Comentários</button>
    </form>
</div>

<div id="comentarios">
    <!-- Seção principal -->
    <div id="main-content">
        <ul>
            {% for comentario in comentarios %}
                <li>{{ comentario.comentario }} - {{ comentario.data }}</li>
            {% else %}
                <li>Nenhum comentário encontrado.</li>
            {% endfor %}
        </ul>

        <button id="novoComentarioBtn">Escrever novo comentário</button>
        <div id="overlay"></div>

        <div id="novoComentarioForm" style="display:none;">
            <form action="/enviar_comentario" method="POST">
                <textarea name="comentario" required></textarea><br>
                <label for="vereador_id">Vereador (opcional):</label>
                <select name="vereador_id">
                    <option value="">--Selecione um vereador--</option>
                    {% for vereador in vereadores %}
                        <option value="{{ vereador.id }}">{{ vereador.nome }}</option>
                    {% endfor %}
                </select><br>

                <label for="partido_id">Partido (opcional):</label>
                <select name="partido_id">
                    <option value="">--Selecione um partido--</option>
                    {% for partido in partidos %}
                        <option value="{{ partido.id }}">{{ partido.nome }}</option>
                    {% endfor %}
                </select><br>

                <label for="comissao_id">Comissão (opcional):</label>
                <select name="comissao_id">
                    <option value="">--Selecione uma comissão--</option>
                    {% for comissao in comissoes %}
                        <option value="{{ comissao.id }}">{{ comissao.nome }}</option>
                    {% endfor %}
                </select><br>

                <input type="submit" value="Enviar Comentário">
            </form>
        </div>
    </div>

    <!-- Seção lateral para últimos comentários -->
    <aside id="sidebar">
        <h3>Últimos Comentários</h3>
        <ul>
            {% for comentario in ultimos_comentarios %}
                <li>{{ comentario.comentario }} - {{ comentario.data }}</li>
            {% endfor %}
        </ul>
    </aside>
</div>

<footer>
    Clique em algum perfil para visualizar especificamente
</footer>

<!-- Script para controle do modal -->
{% block scripts %}
<script>
    document.getElementById("novoComentarioBtn").onclick = function() {
        var form = document.getElementById("novoComentarioForm");
        var overlay = document.getElementById("overlay");
        form.style.display = "block";
        overlay.classList.add("active");
    };

    document.getElementById("overlay").onclick = function() {
        var form = document.getElementById("novoComentarioForm");
        var overlay = document.getElementById("overlay");
        form.style.display = "none";
        overlay.classList.remove("active");
    };

    // Código do carrossel
    const track = document.querySelector('.carousel-track');
    let index = 0;

    function moveCarousel() {
        const totalImages = document.querySelectorAll('.carousel-track img').length;
        const imageWidth = document.querySelector('.carousel-track img').clientWidth;
        const maxIndex = totalImages - Math.floor(window.innerWidth / (imageWidth + 20)); // Ajusta de acordo com o número visível de imagens

        // Incrementa o índice para mover o carrossel
        index++;
        if (index > maxIndex) {
            index = 0; // Reinicia quando chegar ao final
        }

        // Move o carrossel
        track.style.transform = `translateX(-${index * (imageWidth + 20)}px)`;
    }

    // Faz o carrossel mover automaticamente a cada 3 segundos
    setInterval(moveCarousel, 3000);
</script>
{% endblock %}

{% endblock %}
